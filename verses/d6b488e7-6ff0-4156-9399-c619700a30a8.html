<!DOCTYPE html>
<html lang="en">
<head>
    <title>Techshack Weekly - Linode Kubernetes 使用入门</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" />
        <link rel="stylesheet" href="https://www.soasme.com/techshack.weekly/theme/css/main.css" type="text/css" />
        <link href="https://www.soasme.com/techshack.weekly/" type="application/atom+xml" rel="alternate" title="Techshack Weekly ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.soasme.com/techshack.weekly/css/ie.css"/>
                <script src="https://www.soasme.com/techshack.weekly/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.soasme.com/techshack.weekly/css/ie6.css"/><![endif]-->

</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-lg-2"></div>
            <div id="content" class="col-lg-6">
                <div class="entry">
<section id="content" class="body">
  <header>
    <h2 class="entry-title">Linode Kubernetes 使用入门</h2>
  </header>
  <div class="entry-content">
        <p><a href="https://linode.com/docs/applications/containers/manage-a-docker-cluster-with-kubernetes/">查看原文</a></p>
<p>本文介绍了使用三个 Linode 节点搭建 Kubernetes 集群的入门教程。它假设你已经搭建好了一个 kubernetes master，以及两个 worker nodes。</p>
<ul>
<li>文章从 pods 的一句话简介开始：Pod 是对外暴露同一个服务的一个/多个容器组成的逻辑实体，共享网络和存储；操作 Pod 的时候，其中的容器会当作一个组一起被启动或停止。</li>
<li>使用 YAML 创建 Deployment，有了这个应用才能部署到集群中。<ul>
<li><code>kubectl create -f nginx.yaml --record</code> 创建部署，record 可以记录后续的部署变更。</li>
<li><code>kubectl get deployments</code> 查看部署。</li>
<li><code>kubectl get pods</code> 查看 pods。</li>
<li><code>kubectl scale deployment nginx-server --replicas=8</code> 可以扩容，同理可以调小数字缩容。</li>
<li><code>kubectl set image deployment/nginx-server nginx=nginx:1.13.8-alpine</code> 可以替换镜像实现滚动升级。k8s 保证 pod 中有 25% 的容器运行，并且删掉前一定会新建出来一个。</li>
<li><code>kubectl rollout status deployment/nginx-server</code> 查看滚动升级的进度</li>
<li><code>kubectl describe pod $YOUR_POD</code> ^ 或者直接查看 pod 的描述。</li>
<li>如果卡住了或者升级失败，需要 ctrl-c, 不会波及正在运行的程序。</li>
<li><code>kubectl rollout undo deployment/nginx-server</code> 可以滚来滚去</li>
<li><code>kubectl rollout undo deployment/nginx-server --to-revision=1</code> 可以滚一丢丢</li>
</ul>
</li>
<li>使用 YAML 新建 Service，有了这个部署的应用才能被外部访问到。<ul>
<li><code>kubectl create -f nginx-service.yaml</code> yaml 文件中要声明 port 的指定关系。</li>
<li><code>kubectl get services</code> 查看所有服务。一般这时候用 curl 可以看到服务部署成功了么。</li>
</ul>
</li>
<li>使用 YAML 新建 namespace，使用它可以将服务从属于一个命名空间，方便做 dev / staging / prod 等环境的区隔。<ul>
<li>使用 namespace 的话，kubectl 操作需要有 上下文，可以用 <code>kubectl config current-context</code> 配置 context</li>
<li><code>kubectl config set-context dev --namespace=development  --cluster=kubernetes --user=kubernetes-admin</code> 可以添加 context</li>
<li><code>kubectl config use-context dev</code> 切换 context。</li>
</ul>
</li>
<li><code>kubectl get nodes</code>：节点可以算 k8s 中的顶级领域模型了。<ul>
<li><code>kubectl cordon kube-worker-2</code> 使用  cordon 避免新的 pods 在某个节点上创建</li>
<li><code>kubectl drain kube-worker-2 --ignore-daemonsets</code> 之后，我们可以用 drain 逐步关停其上的服务。</li>
<li>当维护操作结束后，<code>kubectl uncordon kube-worker-2</code> 重新加回来。</li>
</ul>
</li>
</ul>
<p><img alt="" src="https://linode.com/docs/assets/manage-a-docker-cluster-with-kubernetes/kubernetes-cluster.png"></p>

  </div><!-- /.entry-content -->
</section>
                </div>

                <hr>
                <div id="footer" class="col-lg-12">
                    <nav>
                        <ul>
                        </ul>
                    </nav>
                </div>
            </div>
            <div id="sidebar" class="col-lg-4">
                <h1>
                    <a href="https://www.soasme.com/techshack.weekly " title="Techshack Weekly">
                        <img src="https://www.soasme.com/techshack.weekly/images/logo-200x50.png" />
                    </a>
                </h1>
                <span class="description"> </span>
                <div><div class="entry-subscription">
    <h5>Techshack Weekly</h5>
    <br>
    专注于后端技术阅读
    <br>
    目前有上百位订阅者。
    <br>
    订阅 <a href="https://www.soasme.com/techshack.weekly/feeds/issues.atom.xml">RSS</a>
    <br>
    欢迎加入 <a href="https://t.me/techshack">Telegram Channel</a> ，
    <br>
    <iframe src="https://tgwidget.com/widget/count/?id=5a66b26483ba88e7118b4568" frameborder="0" scrolling="no" horizontalscrolling="no" verticalscrolling="no" width="160px" height="50px" async></iframe>
    <br>
    关注推特 <a href="https://twitter.com/techshackweekly">@techshackweekly</a>。
    <br>
    <a href="https://twitter.com/TechshackWeekly?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @TechshackWeekly</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <hr>
</div></div>
                <div><!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif;  width:250px;}
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://soasme.us17.list-manage.com/subscribe/post?u=617c1cb80ba1b0cbf828df387&amp;id=10442a8ee6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    <label for="mce-EMAIL">Subscribe to our mailing list</label>
    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_617c1cb80ba1b0cbf828df387_10442a8ee6" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

<!--End mc_embed_signup--></div>
                    <div>:: <a href="https://www.soasme.com/techshack.weekly/categories.html">Categories</a></div>
                <!-- <span class="feed"><a href="">RSS</a> | <a href="">Atom</a></span> -->
            </div>
            <div class="col-lg-2"></div>
        </div>
    </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-36183732-2");
    pageTracker._trackPageview();
    } catch(err) {}</script>
</body>
</html>
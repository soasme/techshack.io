<!DOCTYPE html>
<html lang="en">
<head>
    <title>Techshack Weekly - Bash 使用需要避免掉坑的地方</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" />
        <link rel="stylesheet" href="https://www.soasme.com/techshack.weekly/theme/css/main.css" type="text/css" />
        <link href="https://www.soasme.com/techshack.weekly/" type="application/atom+xml" rel="alternate" title="Techshack Weekly ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.soasme.com/techshack.weekly/css/ie.css"/>
                <script src="https://www.soasme.com/techshack.weekly/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.soasme.com/techshack.weekly/css/ie6.css"/><![endif]-->

</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-lg-2"></div>
            <div id="content" class="col-lg-6">
                <div class="entry">
<section id="content" class="body">
  <header>
    <h2 class="entry-title">Bash 使用需要避免掉坑的地方</h2>
  </header>
  <div class="entry-content">
        <p><a href="https://mywiki.wooledge.org/BashPitfalls">查看原文</a></p>
<p>本文列出了五十多项在使用 Bash 的时候需要注意的地方，Bash 是如此强大但又非常容易出错，一不小心就会删干净你计算机中没备份的文件。如果说人在不停地试错中学习，本文给出了绝佳的避免犯错的清单。</p>
<ul>
<li>通配符(*)，空格( ), 有 leading-dash (-打头的文件), 有 <code>!</code> 是很多错误的本源。这些东西让 bash 很魔法，也很魔幻。每一行 sh 代码都要好好想想字符串或者变量中是否会存在被转义的可能，如果会，配置好环境变量或者加上 quote。<ul>
<li>for i in 后面要用通配符 或者使用 find -exec.</li>
<li>cp 的时候 <code>"./$file"</code> 这样比较靠谱。</li>
<li><code>[[ $var ==</code> <code>[[</code> 比较人性能识别 <code>$var</code> 的空格</li>
<li><code>[ "$var" =</code> <code>[</code> 就比较不人性了，得加 <code>"$var"</code> quote.</li>
<li>很多人没有注意到 <code>if [ a = b ]</code> 的 if 后面有个空格，一定要注意啊，<code>[</code> 是个命令，不是高级语言的 <code>(</code>.</li>
<li><code>echo "$foo"</code> 会比 <code>echo $foo</code> 更安全，万一  <code>$foo</code> 里面有空格呢？</li>
<li><code>a=b</code> 才是正解, <code>a="b"</code>是上上解，写成 <code>a = b</code>, <code>a =b</code>, <code>a= b</code> 都是不对的</li>
<li>交互模式下 <code>echo "hello world\!"</code> 才能避免 <code>!</code> 被 histexpand, 或者干脆 <code>'hello world!'</code> 或者加上 <code>set +H</code></li>
<li><code>~</code> 只有在 token 的第一个字符才会被替换成 $HOME, 安全起见，还是写成 <code>$HOME</code> 靠谱一些。</li>
</ul>
</li>
<li>一些 shell 的语法长的和高级语言差不多，但其实不是<ul>
<li>上面的 <code>[</code>, <code>[[</code> 是一个例子</li>
<li><code>cmd1 &amp;&amp; cmd2 || cmd3</code> &lt;- 这个和 if (cmd1) then cmd2 else cmd fi 是不完全等价的，&amp;&amp; 会去看后面的命令是否返回 0，否则 cmd3 还是会被调用。</li>
<li><code>function foo() { ... }</code> 不一定都能工作啦，看你用什么 shell，但是 <code>foo() { ... }</code> 都肯定可以移植运行成功的。</li>
<li><code>read $foo</code> 是错的，得写成 <code>IFS= read -r foo</code>, 尽管你取值的时候要用 <code>$foo</code>, 以及记得加quote 如果不安全的话。</li>
<li><code>cat file | sed s/foo/bar/ &gt; file</code> 很多人都会一不小心写出来的东西：读文件，经过管道，写回文件，这只会让 file 的内容被清空。比较安全的做法是写到 tmpfile 在 mv 回来，或者对自己的 sed 技术够自信的话可以 edit in-place.</li>
<li><code>cd /foo; bar</code> 很多人都假定 bash 像高级语言一样，出错后崩溃就不往下执行了，并非如此。你要么得提前配置 <code>set -e</code>, 要么这里写成 <code>cd /foo &amp;&amp; bar</code>, 或者 <code>cd /foo !! exit 1; bar</code></li>
</ul>
</li>
</ul>
<p>衍生思考：死ね，Bash!</p>

  </div><!-- /.entry-content -->
</section>
                </div>

                <hr>
                <div id="footer" class="col-lg-12">
                    <nav>
                        <ul>
                        </ul>
                    </nav>
                </div>
            </div>
            <div id="sidebar" class="col-lg-4">
                <h1>
                    <a href="https://www.soasme.com/techshack.weekly " title="Techshack Weekly">
                        <img src="https://www.soasme.com/techshack.weekly/images/logo-200x50.png" />
                    </a>
                </h1>
                <span class="description"> </span>
                <div><div class="entry-subscription">
    <h5>Techshack Weekly</h5>
    <br>
    专注于后端技术阅读
    <br>
    目前有上百位订阅者。
    <br>
    订阅 <a href="https://www.soasme.com/techshack.weekly/feeds/issues.atom.xml">RSS</a>
    <br>
    欢迎加入 <a href="https://t.me/techshack">Telegram Channel</a> ，
    <br>
    <iframe src="https://tgwidget.com/widget/count/?id=5a66b26483ba88e7118b4568" frameborder="0" scrolling="no" horizontalscrolling="no" verticalscrolling="no" width="160px" height="50px" async></iframe>
    <br>
    关注推特 <a href="https://twitter.com/techshackweekly">@techshackweekly</a>。
    <br>
    <a href="https://twitter.com/TechshackWeekly?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @TechshackWeekly</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <hr>
</div></div>
                <div><!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif;  width:250px;}
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://soasme.us17.list-manage.com/subscribe/post?u=617c1cb80ba1b0cbf828df387&amp;id=10442a8ee6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    <label for="mce-EMAIL">Subscribe to our mailing list</label>
    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_617c1cb80ba1b0cbf828df387_10442a8ee6" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

<!--End mc_embed_signup--></div>
                    <div>:: <a href="https://www.soasme.com/techshack.weekly/categories.html">Categories</a></div>
                <!-- <span class="feed"><a href="">RSS</a> | <a href="">Atom</a></span> -->
            </div>
            <div class="col-lg-2"></div>
        </div>
    </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-36183732-2");
    pageTracker._trackPageview();
    } catch(err) {}</script>
</body>
</html>
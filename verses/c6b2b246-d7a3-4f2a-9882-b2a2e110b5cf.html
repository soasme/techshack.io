<!DOCTYPE html>
<html lang="en">
<head>
    <title>Techshack Weekly - Kubernetes 初学者超级简单入门帖</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" />
        <link rel="stylesheet" href="https://www.soasme.com/techshack.weekly/theme/css/main.css" type="text/css" />
        <link href="https://www.soasme.com/techshack.weekly/" type="application/atom+xml" rel="alternate" title="Techshack Weekly ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.soasme.com/techshack.weekly/css/ie.css"/>
                <script src="https://www.soasme.com/techshack.weekly/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.soasme.com/techshack.weekly/css/ie6.css"/><![endif]-->

</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-lg-2"></div>
            <div id="content" class="col-lg-6">
                <div class="entry">
<section id="content" class="body">
  <header>
    <h2 class="entry-title">Kubernetes 初学者超级简单入门帖</h2>
  </header>
  <div class="entry-content">
        <p><a href="https://blog.sourcerer.io/a-kubernetes-quick-start-for-people-who-know-just-enough-about-docker-to-get-by-71c5933b4633">查看原文</a></p>
<p>Kubernetes 是 helmsman / pilot 的希腊语，用来做自动部署和容器程序的扩展和管理。它的前身是 Google 内部的类似系统 Borg。将程序放在容器里面简化了运维操作，但是部署还有一箩筐的事情要处理，这就是 Kubernetes 存在的意义。这篇文章介绍了什么是 Kubernetes，什么是 Clusters，如何创建本地 cluster，如何创建生产环境的 cluster，如何部署到 Kubernetes 中，以及一个例子。</p>
<ul>
<li>你不用操心应用实例是不是在运行，如果挂了，Kubernetes 会自动新建实例。</li>
<li>掌握一些 Kubernetes 的核心概念：<ul>
<li>Cluster: 一个容器网络，它们之间可以互相通信。</li>
<li>Nodes: Cluster 里面跑的的节点。</li>
<li>Master：可以控制其他节点，所有操作命令跑在 master 上，Master 决定 Cluster 里面的哪个节点跑应用。</li>
<li>Network: Kubernetes 假设你搞好了网络可以让节点互相通信。有很多开源方案可以选择。</li>
<li>Kubernetes API: Master 开放出来的接口</li>
<li>Kubelet: 每个 Node 上跑着 Kubelet，负责管理当前 Node，以及和 Master 通信。通信使用 Kubernetes API。</li>
<li>kubectl: 一个命令行工具，调用 Kubernetes API 和 Master 通信用来管理。</li>
<li>kubeadm: 一个用来初始化 cluster 的程序，能给 Cluster 配置好所需要的 add-ons。</li>
<li>etcd: 一个分布式 key-value 数据仓库。存储了所有 Cluster Nodes 的信息。</li>
<li>Kubernetes objects: 是 cluster 中操作的基本对象，也是会在 Kubernetes 中存储的数据。这些数据用来描述 Cluster 应该处于的状态。包括 deployments, replica sets, services, pods, etc.</li>
<li>Pod: 一组容器(比如 docker containers)以及它们之间的关系；它们之间有共享的网络和存储。在网络上，这组容器可以通过一个独立 IP 地址访问。</li>
<li>Service: 定义了 Pods 的逻辑分组 以及如何访问它们。因为 Pod 很容易被创建和销毁，Kubernetes 引入了 Service，只要给 Pods 给一个标签，所以流量都会由标签指定的 Service 处理。</li>
<li>Deployment: 设定预期状态，如果不符合，Kubernetes 会保证 Cluster 达到这个状态。Deployment 告诉了 Kubernetes 如何创建和更新应用的实例。</li>
</ul>
</li>
<li>好处：支持 rolling updates / zero downtime，节点同一时刻总是有多个实例运行。</li>
<li>还有啥要考虑：数据存储。因为 Docker 是 stateless 的，所以要想好数据存到哪里。</li>
<li>如何搭建本地环境：安装 virtualbox, kubectl, docker, minikube。然后使用 <code>minikube start</code> / <code>minikube stop</code> 就能玩了。</li>
<li>如何搭建生产环境（大约5分钟）<ul>
<li>前提是所有机器已经配置好了 VPN</li>
<li>安装 docker, kubelet, kubeadm, kubectl</li>
<li><code>export MASTER_IP=&lt;master_ip&gt;</code></li>
<li><code>kubeadm init --apiserver-advertise-address $MASTER_IP</code>: 初始化 Cluster，生成一堆配置文件等等。</li>
<li>复制 <code>/etc/kubernetes/admin.conf</code> 到某个地方，设置 <code>export KUBECONFIG=</code> 这个文件。</li>
<li>安装 pod network: <code>sysctl net.bridge.bridge-nf-call-iptables=1; kubectl apply -f "https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\n')"</code></li>
<li>可以自由地用 kubectl 玩耍了。</li>
<li>在 Node 节点上跑一下 kubeadm join 命令（可以在 kubeadm init 的输出里找到) 就能加入 Cluster 了。</li>
</ul>
</li>
<li>如何部署应用<ul>
<li><code>kubectl run nginx --image=nginx</code></li>
<li><code>kubectl get deployment nginx</code></li>
<li><code>kubectl expose deployment nginx --external-ip=$MASTER_IP --port=80 --target-port=80</code></li>
<li><code>kubectl get service</code></li>
<li><code>kubectl scale deployment nginx --replicas=6</code></li>
<li><code>kubectl get pods</code></li>
<li>可以写一堆 yml 文件，然后用 <code>kubectl create -f xxx.yml</code> 去应用它。</li>
</ul>
</li>
</ul>

  </div><!-- /.entry-content -->
</section>
                </div>

                <hr>
                <div id="footer" class="col-lg-12">
                    <nav>
                        <ul>
                        </ul>
                    </nav>
                </div>
            </div>
            <div id="sidebar" class="col-lg-4">
                <h1>
                    <a href="https://www.soasme.com/techshack.weekly " title="Techshack Weekly">
                        <img src="https://www.soasme.com/techshack.weekly/images/logo-200x50.png" />
                    </a>
                </h1>
                <span class="description"> </span>
                <div><div class="entry-subscription">
    <h5>Techshack Weekly</h5>
    <br>
    专注于后端技术阅读
    <br>
    目前有上百位订阅者。
    <br>
    订阅 <a href="https://www.soasme.com/techshack.weekly/feeds/issues.atom.xml">RSS</a>
    <br>
    欢迎加入 <a href="https://t.me/techshack">Telegram Channel</a> ，
    <br>
    <iframe src="https://tgwidget.com/widget/count/?id=5a66b26483ba88e7118b4568" frameborder="0" scrolling="no" horizontalscrolling="no" verticalscrolling="no" width="160px" height="50px" async></iframe>
    <br>
    关注推特 <a href="https://twitter.com/techshackweekly">@techshackweekly</a>。
    <br>
    <a href="https://twitter.com/TechshackWeekly?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @TechshackWeekly</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <hr>
</div></div>
                <div><!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif;  width:250px;}
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://soasme.us17.list-manage.com/subscribe/post?u=617c1cb80ba1b0cbf828df387&amp;id=10442a8ee6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    <label for="mce-EMAIL">Subscribe to our mailing list</label>
    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_617c1cb80ba1b0cbf828df387_10442a8ee6" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

<!--End mc_embed_signup--></div>
                    <div>:: <a href="https://www.soasme.com/techshack.weekly/categories.html">Categories</a></div>
                <!-- <span class="feed"><a href="">RSS</a> | <a href="">Atom</a></span> -->
            </div>
            <div class="col-lg-2"></div>
        </div>
    </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-36183732-2");
    pageTracker._trackPageview();
    } catch(err) {}</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Techshack Weekly </title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" />
        <link rel="stylesheet" href="https://www.soasme.com/techshack.weekly/theme/css/main.css" type="text/css" />
        <link href="https://www.soasme.com/techshack.weekly/" type="application/atom+xml" rel="alternate" title="Techshack Weekly ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.soasme.com/techshack.weekly/css/ie.css"/>
                <script src="https://www.soasme.com/techshack.weekly/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.soasme.com/techshack.weekly/css/ie6.css"/><![endif]-->

</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-lg-2"></div>
            <div id="content" class="col-lg-6">
                <div class="entry">
        
        

 
                <section id="content" class="body">
            <div>
                <article class="hentry">
                    <header>
                        <h3>
                            <a href="https://www.soasme.com/techshack.weekly/verses/cd32888d-da2b-4771-b742-e8481ac3dc82.html" rel="bookmark"
                                title="Permalink to Prometheus 监控最佳实践"
                                >Prometheus 监控最佳实践</a>
                        </h3>
                    </header>
                    <div class="entry-content">
                        <p><a href="https://prometheus.io/docs/practices/instrumentation/">查看原文</a></p>
<p>本文是 Prometheus 的一份文档，提供了一系列侵入代码做监控时的建议。</p>
<ul>
<li>监控任何东西，能想到的。一个程序中的每个部分都至少有一些指标可以让我们看到它们工作地肿么样。</li>
<li>侵入代码的监控就跟日志一样，可以做到就在代码那个文件做初始化。</li>
<li>一般监控的东西可以是：<ul>
<li>在线服务: 推荐采集的指标：qps/qpm, errors, latency. 如果有客户端可以在 c/s 两端都采集。</li>
<li>离线服务: 推荐采集的指标：in_progress_num, processed_num, last_processed_time. 如果系统不是一直都在工作，建议发心跳工作包给服务，服务简单处理下时间啊什么的，确保它是一直是响应着的。</li>
<li>Batch Job：它可能只是一次性的任务。推荐使用 pushgateway 推数据给 prometheus。采集的指标可以是：运行了多久，每一步花了多久，什么时候结束，成功还是失败。如果这个 batch job 以固定频率运行，建议转成 offline-processing。</li>
<li>Library: 推荐采集的指标 …</li></ul></li></ul>
                        <a class="readmore" href="https://www.soasme.com/techshack.weekly/verses/cd32888d-da2b-4771-b742-e8481ac3dc82.html"
                            >read more</a>
                    </div><!-- /.entry-content -->
                </article>
            </div>


        

 
            <div>
                <article class="hentry">
                    <header>
                        <h3>
                            <a href="https://www.soasme.com/techshack.weekly/verses/34c8561f-a4fb-4b18-a9ef-9dd34af754eb.html" rel="bookmark"
                                title="Permalink to Poetry - 一种非常规的 Python 依赖管理工具"
                                >Poetry - 一种非常规的 Python 依赖管理工具</a>
                        </h3>
                    </header>
                    <div class="entry-content">
                        <p><a href="https://github.com/sdispater/poetry">查看原文</a></p>
<p>Poetry 项目借鉴 cargo/composer 的经验，在给 Python 配置元信息的时候，你只需要定义 <code>pyproject.toml</code>，使用相应的 poetry build, poetry publish 等命令可构建 wheel 并发布到 PyPI。</p>
<ul>
<li>每次要写一个新的包，都要配 setup.py MANIFEST.in setup.cfg Pipfile 这些确实很烦人。不再需要写 setup.py 这个文件确实是个加分项。</li>
<li>跟 Pipfile 的区别：Pipefile 说白了就是 requirements.txt 的升级版，poetry 有更大的野心：想把所有项目元信息配置相关的部分都包揽了。</li>
</ul>
<p>更新：</p>
<ul>
<li>2018-04-20: 用一阵子再来反馈。</li>
</ul>
                        <a class="readmore" href="https://www.soasme.com/techshack.weekly/verses/34c8561f-a4fb-4b18-a9ef-9dd34af754eb.html"
                            >read more</a>
                    </div><!-- /.entry-content -->
                </article>
            </div>


        

 
            <div>
                <article class="hentry">
                    <header>
                        <h3>
                            <a href="https://www.soasme.com/techshack.weekly/verses/384bfb0c-e6f8-4f40-8b05-43944c5fe232.html" rel="bookmark"
                                title="Permalink to Helm Cheatsheet"
                                >Helm Cheatsheet</a>
                        </h3>
                    </header>
                    <div class="entry-content">
                        <p><a href="https://docs.helm.sh/using_helm/">查看原文</a></p>
<p>本文是 Kubernetes 部署工具 Helm 的使用指南，描述了它的基本使用场景。</p>
<ul>
<li>使用前提：<ul>
<li>有 Kubernetes cluster，本地 kubectl 都配置好了可以连上需要的集群，可以使用 <code>kubectl config current-context</code> 查看是否正确。</li>
<li>minikube 不需要额外配置</li>
<li>coreos 需要有 socat 安装。</li>
</ul>
</li>
<li>Helm init: <ul>
<li>在 minikube 中使用 Helm 无所谓啦，用默认配置就成，没有安全方面的考量；否则是需要额外做一些安全方面的配置，例如 rbac，tls 等等。</li>
<li>helm init 会在 k8s 中启动 tiller</li>
</ul>
</li>
<li>重置 helm：<code>helm reset</code><ul>
<li>helm …</li></ul></li></ul>
                        <a class="readmore" href="https://www.soasme.com/techshack.weekly/verses/384bfb0c-e6f8-4f40-8b05-43944c5fe232.html"
                            >read more</a>
                    </div><!-- /.entry-content -->
                </article>
            </div>


        

 
            <div>
                <article class="hentry">
                    <header>
                        <h3>
                            <a href="https://www.soasme.com/techshack.weekly/verses/fd61aed8-3267-47f8-8d4b-d4881a11d382.html" rel="bookmark"
                                title="Permalink to The Kubernetes Helm Architecture"
                                >The Kubernetes Helm Architecture</a>
                        </h3>
                    </header>
                    <div class="entry-content">
                        <p><a href="https://docs.helm.sh/architecture/">查看原文</a></p>
<p>这篇文章简要地介绍了 Helm 的架构。</p>
<ul>
<li>Helm 打包，上传，安装，卸载，升级 Charts, Chart 可以被应用到 Kubernetes 集群上，创建出应用程序来。</li>
<li>Helm 有最重要的 3 个概念：<ul>
<li>chart：创建程序所必须的信息。</li>
<li>config：程序的配置。</li>
<li>release：根据 chart+config 创建出来的运行实例。</li>
</ul>
</li>
<li>Helm 的 2 个组件：<ul>
<li>Helm Client：在本机做开发，管理仓库，以及发布 Chart。</li>
<li>Tiller Server：运行在 cluster 中，可以跟 Kubernetes apiserver 通信，将 chart …</li></ul></li></ul>
                        <a class="readmore" href="https://www.soasme.com/techshack.weekly/verses/fd61aed8-3267-47f8-8d4b-d4881a11d382.html"
                            >read more</a>
                    </div><!-- /.entry-content -->
                </article>
            </div>


        

 
            <div>
                <article class="hentry">
                    <header>
                        <h3>
                            <a href="https://www.soasme.com/techshack.weekly/verses/47900a1c-0826-49da-ae23-f46b68c560db.html" rel="bookmark"
                                title="Permalink to 如何使用 Federation 管理多个 Kubernetes Clusters"
                                >如何使用 Federation 管理多个 Kubernetes Clusters</a>
                        </h3>
                    </header>
                    <div class="entry-content">
                        <p><a href="https://kubernetes.io/docs/concepts/cluster-administration/federation/">查看原文</a></p>
<p>这篇文档介绍了为什么以及如何使用 Federation 管理 Kubernetes 集群。</p>
<ul>
<li>多个小集群联邦比一个大集群来的安全一些，俗话说鸡蛋不要放一个篮子。万一挂了一个 region，其它的还能正常运行。</li>
<li>资源可在集群间互相访问，简单来说，某个 deployment 可以在其它 clusters 里面。</li>
<li>自动帮你配好了 dns &amp; load balancers，简单来说，一个域名的流量可以分派到多个 clusters 中的后端服务。</li>
<li>单个集群有节点上限，k8s v1.8 可以支持到 5000 个节点，使用联邦可以把这个数字乘上去。</li>
<li>hybrid cloud: 一个集群用 google 家的，另一个集群用 amazon 家的。除了鸡蛋篮子这个考量，也有人不想锁死一家的技术。</li>
<li>一个 kubernetes cluster 建议在一个 az 中 …</li></ul>
                        <a class="readmore" href="https://www.soasme.com/techshack.weekly/verses/47900a1c-0826-49da-ae23-f46b68c560db.html"
                            >read more</a>
                    </div><!-- /.entry-content -->
                </article>
            </div>


        

 
            <div>
                <article class="hentry">
                    <header>
                        <h3>
                            <a href="https://www.soasme.com/techshack.weekly/verses/7d7be496-307f-403a-b758-078ab7b74145.html" rel="bookmark"
                                title="Permalink to Dapper - Google Tracing System"
                                >Dapper - Google Tracing System</a>
                        </h3>
                    </header>
                    <div class="entry-content">
                        <p><a href="http://static.googleusercontent.com/media/research.google.com/zh-CN//pubs/archive/36356.pdf">查看原文</a></p>
<p>这篇论文介绍了 Google Tracing System 的架构和使用情况。Google 在 black-box 和 annotation 方案中选择了后者。它准确率更高，但也因海量数据引入维护复杂的问题。论文花了2/3的篇幅介绍系统的运行情况。Dapper 的维护团队说几乎所有的 Google 的生产环境的程序可能都植入了 Dapper。</p>
<ul>
<li>这个系统使用一系列ID标记调用链，每个服务调用记录根节点ID，父节点ID，自身ID，主机，时间戳。用户请求是调用链的根节点。一次服务调用会有至少两次日志记录，开始+结束。</li>
<li>允许服务添加业务数据（注解）到日志（有个数限制）。</li>
<li>记开头的原因与服务器时间不同步有关。</li>
<li>追踪触发点：进程内的上下文有追踪容器，异步调用和同步调用使用两个公共的库，该两个库都保证异步调用上会带上追踪信息。</li>
<li>性能损耗：可以选择性地关停，或做采样。损耗非常低，不纳入采样 9 ns, 否则 40ns 左右 …</li></ul>
                        <a class="readmore" href="https://www.soasme.com/techshack.weekly/verses/7d7be496-307f-403a-b758-078ab7b74145.html"
                            >read more</a>
                    </div><!-- /.entry-content -->
                </article>
            </div>


        

 
            <div>
                <article class="hentry">
                    <header>
                        <h3>
                            <a href="https://www.soasme.com/techshack.weekly/verses/dd8e9b7e-6688-4b5b-bfb3-ddd35393ba7f.html" rel="bookmark"
                                title="Permalink to Vim Register"
                                >Vim Register</a>
                        </h3>
                    </header>
                    <div class="entry-content">
                        <p><a href="https://stackoverflow.com/questions/1497958/how-do-i-use-vim-registers">查看原文</a></p>
<p>这篇 stackoverflow 问答讲述了不少 vim register 的使用场景和技巧。</p>
<ul>
<li><code>:reg</code> 可以查看所有注册的 register</li>
<li>按 qa/qb/qc/... 开始录制动作到 a/b/c/...，结束后按 q 退出。稍后可将行为用 @m 将 m 应用到本行，@@ 重复，100@m 就应用 m 100 次。你可以用 <code>"ma</code> / <code>"mb</code> / ... 查看 register 录制的动作。</li>
<li><code>"1p</code> 可以把最近删除的东西再放出来</li>
</ul>
                        <a class="readmore" href="https://www.soasme.com/techshack.weekly/verses/dd8e9b7e-6688-4b5b-bfb3-ddd35393ba7f.html"
                            >read more</a>
                    </div><!-- /.entry-content -->
                </article>
            </div>


        

 
            <div>
                <article class="hentry">
                    <header>
                        <h3>
                            <a href="https://www.soasme.com/techshack.weekly/verses/b3ae7899-7a40-4a9f-9a27-9bd8dae1b06a.html" rel="bookmark"
                                title="Permalink to PyPI 切新版发生的事故报告"
                                >PyPI 切新版发生的事故报告</a>
                        </h3>
                    </header>
                    <div class="entry-content">
                        <p><a href="https://status.python.org/incidents/1y1f44q6srh2">查看原文</a></p>
<p>这个报告阐述了为什么 PyPI 切新版造成了一个半小时内 pip install 都失败的事故，又是一起测试时啥都好一上线就崩溃的案例。简单来说，本来打算所有 <code>https://pypi.python.org/packages/....</code> 都切换到 <code>https://files.pythonhosted.org/packages/...</code>，但是发生了无限 302 跳转外加 404 外加 500；发生的原因是 pypi.python.org 到 pypi.org 的 CDN shielding 配置有问题，结果请求被转回了老服务，而老服务又有跳转到新服务的规则。紧急修复还造成了 500，404 等情况。<a href="https://twitter.com/gvanrossum/status/986069012520910848">龟叔</a> 的评价是这篇写的真好懂。。。</p>
<p>顺便说个趣事，pypi 的故障让龟叔使出了 <code>sudo …</code></p>
                        <a class="readmore" href="https://www.soasme.com/techshack.weekly/verses/b3ae7899-7a40-4a9f-9a27-9bd8dae1b06a.html"
                            >read more</a>
                    </div><!-- /.entry-content -->
                </article>
            </div>


        

 
            <div>
                <article class="hentry">
                    <header>
                        <h3>
                            <a href="https://www.soasme.com/techshack.weekly/verses/fa6b9146-d4de-40ec-bded-f754ee83a5cd.html" rel="bookmark"
                                title="Permalink to 如何快速写出一份架构文档"
                                >如何快速写出一份架构文档</a>
                        </h3>
                    </header>
                    <div class="entry-content">
                        <p><a href="http://www.ecs.csun.edu/~rlingard/COMP684/Example2SoftArch.htm">查看原文</a></p>
<p>这份模板给出了软件架构文档的基本框架。</p>
<ul>
<li>一般从 introduction 说起，把设计目标，设计的范围说清楚</li>
<li>然后把系统约束说清楚，有什么会制约当前的设计，未来会怎么改进</li>
<li>从经典的四视图切入系统设计：Use-Case View，Logical View，Process View，Deployment View。<ul>
<li>Use-Case: 说一些用例，这些用例最好能覆盖到所有的组件；这个视图能把各个视图串在一起</li>
<li>Logical：软件如何在逻辑上分层，这一层还不考虑物理的分布</li>
<li>Process：比较物理了，可以谈到进程，线程，节点，集群，或者时下比较流行的 Pod 等等。</li>
<li>Deployment：如何部署应用，一般现在做 CI，CD 这块有很多现成的工具。</li>
</ul>
</li>
<li>最后把可能的安全，性能等边角问题说清楚。</li>
</ul>
                        <a class="readmore" href="https://www.soasme.com/techshack.weekly/verses/fa6b9146-d4de-40ec-bded-f754ee83a5cd.html"
                            >read more</a>
                    </div><!-- /.entry-content -->
                </article>
            </div>


        

 
            <div>
                <article class="hentry">
                    <header>
                        <h3>
                            <a href="https://www.soasme.com/techshack.weekly/verses/310d7e52-ffb5-4861-99ef-0bc73d5f4dc9.html" rel="bookmark"
                                title="Permalink to 哪家 DNS 解析地最快"
                                >哪家 DNS 解析地最快</a>
                        </h3>
                    </header>
                    <div class="entry-content">
                        <p><a href="https://medium.com/@nykolas.z/dns-resolvers-performance-compared-cloudflare-x-google-x-quad9-x-opendns-149e803734e5">查看原文</a></p>
<p>上结论：CloudFlare Google Quad9 OpenDNS 这些在北美和欧洲的 DNS 解析都很快，响应时间大约 15ms 以下。CloudFlare 在全球 72% 的地方都是最快的，平均响应时间 4.98ms</p>
<ul>
<li>Google 8.8.8.8</li>
<li>CloudFlare 1.1.1.1</li>
<li>Quad9 9.9.9.9</li>
<li>OpenDNS 208.67.222.222</li>
</ul>
                        <a class="readmore" href="https://www.soasme.com/techshack.weekly/verses/310d7e52-ffb5-4861-99ef-0bc73d5f4dc9.html"
                            >read more</a>
                    </div><!-- /.entry-content -->
                </article>
            </div>

<p class="paginator">
        <a href="https://www.soasme.com/techshack.weekly/category/verses24.html">&laquo;</a>
    Page 25 / 54
        <a href="https://www.soasme.com/techshack.weekly/category/verses26.html">&raquo;</a>
</p>
            </section><!-- /#content -->

                </div>

                <hr>
                <div id="footer" class="col-lg-12">
                    <nav>
                        <ul>
                        </ul>
                    </nav>
                </div>
            </div>
            <div id="sidebar" class="col-lg-4">
                <h1>
                    <a href="https://www.soasme.com/techshack.weekly " title="Techshack Weekly">
                        <img src="https://www.soasme.com/techshack.weekly/images/logo-200x50.png" />
                    </a>
                </h1>
                <span class="description"> </span>
                <div><div class="entry-subscription">
    <h5>Techshack Weekly</h5>
    <br>
    专注于后端技术阅读
    <br>
    目前有上百位订阅者。
    <br>
    订阅 <a href="https://www.soasme.com/techshack.weekly/feeds/issues.atom.xml">RSS</a>
    <br>
    欢迎加入 <a href="https://t.me/techshack">Telegram Channel</a> ，
    <br>
    <iframe src="https://tgwidget.com/widget/count/?id=5a66b26483ba88e7118b4568" frameborder="0" scrolling="no" horizontalscrolling="no" verticalscrolling="no" width="160px" height="50px" async></iframe>
    <br>
    关注推特 <a href="https://twitter.com/techshackweekly">@techshackweekly</a>。
    <br>
    <a href="https://twitter.com/TechshackWeekly?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @TechshackWeekly</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <hr>
</div></div>
                <div><!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif;  width:250px;}
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://soasme.us17.list-manage.com/subscribe/post?u=617c1cb80ba1b0cbf828df387&amp;id=10442a8ee6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    <label for="mce-EMAIL">Subscribe to our mailing list</label>
    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_617c1cb80ba1b0cbf828df387_10442a8ee6" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

<!--End mc_embed_signup--></div>
                    <div>:: <a href="https://www.soasme.com/techshack.weekly/categories.html">Categories</a></div>
                <!-- <span class="feed"><a href="">RSS</a> | <a href="">Atom</a></span> -->
            </div>
            <div class="col-lg-2"></div>
        </div>
    </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-36183732-2");
    pageTracker._trackPageview();
    } catch(err) {}</script>
</body>
</html>